<div *ngIf="loader">
    <div class="d-flex justify-content-center">
        <img src="../../../assets/loader.gif" class="loader">
    </div>
</div>

<div *ngIf="!loader">
    <div class="d-flex justify-content-end">
        <button class="btn btn-sm btn-warning" (click)="goTo('/auth/home')">Voltar</button>
    </div>
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <div class="card mt-3 mb-3">
                <div class="card-header text-center">
                    <h2>
                        <strong>
                            Cadastrar Combo
                        </strong>
                    </h2>
                </div>
                <div class="card-body">
                    <form>
                        <div class="row">
                            <div class="col-md-6 mt-3">
                                <label for="" class="form-label">Titulo</label>
                                <input type="text" class="form-control" placeholder="Digite o título" name="titulo"
                                    [(ngModel)]="payloadCombos.titulo" required>
                            </div>
                            <div class="col-md-6 mt-3">
                                <label for="" class="form-label">Valor Promocional Dinheiro</label>
                                <input type="text" class="form-control" placeholder="Digite o valor dinheiro"
                                    name="valor_promocional_dinheiro"
                                    [(ngModel)]="payloadCombos.valor_promocional_dinheiro" required>
                            </div>
                            <div class="col-md-6 mt-3">
                                <label for="" class="form-label">Valor Promocional PIX</label>
                                <input type="text" class="form-control" placeholder="Digite o valor PIX"
                                    name="valor_promocional_pix" [(ngModel)]="payloadCombos.valor_promocional_pix"
                                    required>
                            </div>
                            <div class="col-md-6 mt-3">
                                <label for="" class="form-label">Valor Promocional Cartão</label>
                                <input type="text" class="form-control" placeholder="Digite o valor cartão"
                                    name="valor_promocional_cartao" [(ngModel)]="payloadCombos.valor_promocional_cartao"
                                    required>
                            </div>
                            <div class="col-12 mt-3">
                                <label for="" class="form-label">Descrição</label>
                                <textarea name="descricao" class="form-control"
                                    placeholder="Digite a desrição *(opcional)" [(ngModel)]="payloadCombos.descricao"
                                    rows="5"></textarea>
                            </div>
                        </div>
                        <div class="mt-3 row">
                            <div class="col-12">
                                <div class="text-center">
                                    <h3>
                                        <strong>
                                            Produtos Por Categoria
                                        </strong>
                                    </h3>
                                </div>
                            </div>
                            <div class="col-12">
                                <div *ngFor="let item of categoriasEProdutos"
                                    class="d-flex justify-content-center mt-2 mb-2">
                                    <div class="w-100">
                                        <button class="btn btn-outline-success w-100" type="button"
                                            data-bs-toggle="collapse" [attr.data-bs-target]="'#' + item.id"
                                            aria-expanded="false" aria-controls="collapseExample">
                                            {{item.titulo}}
                                        </button>
                                        <div class="collapse" [attr.id]="item.id">
                                            <div class="row justify-content-center">
                                                <div *ngFor="let produtos of item.produto" class="col-lg-6">
                                                    <div class="card card-body mt-2">
                                                        <span>
                                                            <input type="checkbox" class="m-2"
                                                                (click)="inserirProdutoAoArrayConteudo(produtos)">
                                                            {{produtos.titulo}} - {{formatarMoeda(produtos.valor)}}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <button class="btn btn-sm btn-success w-100"
                                    (click)="cadastrarCombo()">Cadastrar</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <div class="card mt-3 mb-3">
                <div class="card-header text-center">
                    <h3>
                        <strong>
                            Combos
                        </strong>
                    </h3>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table class="table table-striped responsive-table">
                            <thead>
                                <tr class="text-center">
                                    <th scope="col">#</th>
                                    <th scope="col">Titulo</th>
                                    <th scope="col">Produtos</th>
                                    <th scope="col">Status</th>
                                    <th scope="col">Valor Dinheiro</th>
                                    <th scope="col">Valor Pix</th>
                                    <th scope="col">Valor Cartao</th>
                                    <th scope="col">Ação</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of combos" class="text-center">
                                    <td>{{item.id}}</td>
                                    <td>{{item.titulo}}</td>
                                    <td>{{item.conteudo_combos.length}}</td>
                                    <td>
                                        <div class="d-flex justify-content-center">
                                            <div
                                                [class]="item.active ? 'p-2 bg-success mt-1 border-radius ': 'p-2 bg-danger mt-1 border-radius '">
                                            </div>
                                        </div>
                                    </td>
                                    <td>{{formatarMoeda(item.valor_promocional_dinheiro)}}</td>
                                    <td>{{formatarMoeda(item.valor_promocional_pix)}}</td>
                                    <td>{{formatarMoeda(item.valor_promocional_cartao)}}</td>
                                    <td>
                                        <div class="d-flex justify-content-center">
                                            <button (click)="ativarOuDesativarCombo(item)"
                                                [class]="item.active ? 'btn btn-sm btn-danger margin-right' : 'btn btn-sm btn-success margin-right'">
                                                {{item.active ? 'Desativar' : 'Ativar'}}
                                            </button>
                                            <button class="btn btn-sm btn-primary"
                                                (click)="abrirDialogAtualizarCombo(item)">
                                                Editar
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>